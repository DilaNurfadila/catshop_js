<!DOCTYPE html>
<html lang="en">
  <%- include('../../public/template/head.ejs') -%>
  <body>
    <h1>CATSHOP 032</h1>
    <h3>CATS LIST</h3>
    <a href="/">
      <h4>HOME</h4>
    </a>
    <hr />
    <!-- Flash message -->
    <% if (locals.success) { %>
      <p style="color:green;">
        <%= locals.success %>
      </p>
    <% } %>
    <% if (locals.failed) { %>
      <p style="color: red;">
        <%= locals.failed %>
      </p>
    <% } %>
    <a href="/cats/add">Add new cat</a>
    <hr />
    <table border="1">
      <tr>
        <th>No</th>
        <th>Name</th>
        <th>Type</th>
        <th>Gender</th>
        <th>Age (month)</th>
        <th>Price ($)</th>
        <th>Photo</th>
        <th colspan="3">Action</th>
      </tr>
      <% let startIndex = (currentPage - 1) * 10 + 1; 
      cats.forEach((cat, index) => { %>
      <tr>
        <td><%= startIndex + index; %></td>
        <td><%= cat.name_032 %></td>
        <td><%= cat.type_032 %></td>
        <td><%= cat.gender_032 %></td>
        <td><%= cat.age_032 %></td>
        <td><%= cat.price_032 %></td>
        <td>
          <p align="center"><img src="../../uploads/cats/<%= cat.photo_032 %>" alt="Cat photo" width="50" height="50"></p>
          <p><a href="/cats/changephoto/<%= cat.id_032 %>">Change Photo</a></p>
        </td>
        <td><a href="/cats/edit/<%= cat.id_032 %>">Edit</a></td>
        <td>
          <a
            href="/cats/delete/<%= cat.id_032 %>"
            onclick="return confirm('Are you sure?')"
            >Delete</a
          >
        </td>
        <td>
          <% if(cat.sold_032 == 1) { %> SOLD <% } else { %>
          <a href="/cats/sale/<%= cat.id_032 %>">SALE</a>
          <% } %>
        </td>
      </tr>
      <% }); %>
    </table>

    <% if(currentPage > 1 && currentPage <= totalPages) { %>
      <a href="/cats?page=<%= totalPages / totalPages %>" class="next-btn">&lt; First</a>
    <% } %>
    <% if(currentPage > 1) {%>
      <a href="/cats?page=<%= currentPage - 1 %>" class="prev-btn">&lt;</a>
    <% } %>

    <% for(let i = currentPage - 2; i <= currentPage + 2; i++) { %>
      <% if(i >= 1 && i <= totalPages) { %>
        <% if(currentPage === i) { %>
          <span class="current-page"><%= i %></span>
        <% } else { %>
          <a href="/cats?page=<%= i %>" class="page-link"><%= i %></a>
        <% } %>
      <% } %>
    <% } %>

    <% if(currentPage < totalPages) { %>
      <a href="/cats?page=<%= currentPage + 1 %>" class="next-btn">&gt;</a>
    <% } %>

    <% if(currentPage >= 1 && currentPage < totalPages) { %>
        <a href="/cats?page=<%= totalPages %>" class="next-btn">Last &gt;</a>
    <% } %>
  </body>
</html>
